# QUICK FIX - 502 BAD GATEWAY
# Run these commands ONE BY ONE on Hostinger:

# 1. Go to project
cd /var/www/britmetrics
source venv/bin/activate

# 2. Pull latest code
git pull origin main

# 3. Kill EVERYTHING
sudo pkill -9 -f streamlit
sudo pkill -9 -f python3
sudo pkill -9 -f python
sleep 3

# 4. Check what ports are in use
sudo lsof -i :8504

# 5. Start Streamlit on port 8504
nohup streamlit run app.py --server.port 8504 --server.address 0.0.0.0 --server.headless true > /var/log/britmetrics.log 2>&1 &

# 6. Wait and check if it started
sleep 5
ps aux | grep streamlit

# 7. Check logs for errors
tail -30 /var/log/britmetrics.log

# 8. Test if Streamlit is responding
curl http://localhost:8504

# 9. Make sure Nginx points to port 8504
sudo nano /etc/nginx/sites-available/britmetrics
# Verify it says: proxy_pass http://localhost:8504;

# 10. Restart Nginx
sudo systemctl restart nginx
sudo systemctl status nginx

# 11. Test the website
curl http://localhost
